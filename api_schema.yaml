version: 1
endpoints:
  - name: List comments for listing
    method: GET
    path: /api/listings/{listing_id}/comments/
    path_params:
      listing_id: integer
    query:
      limit:
        type: integer
        required: false
        default: 20
        description: Max items to return (1..100)
      offset:
        type: integer
        required: false
        default: 0
        description: Offset for pagination
    response:
      200:
        content-type: application/json
        body:
          count: integer
          limit: integer
          offset: integer
          results: Comment[]
      404:
        description: Listing not found
  - name: Create comment for listing
    method: POST
    path: /api/listings/{listing_id}/comments/
    auth: bearer
    path_params:
      listing_id: integer
    request:
      content-type: application/json
      body:
        content: string
    response:
      201:
        content-type: application/json
        body: Comment
      400:
        description: Banned patterns violated
        content-type: application/json
        body: BannedViolation[]
      401:
        description: Unauthorized
      404:
        description: Listing not found
  - name: Get comment detail
    method: GET
    path: /api/comments/{pk}/
    path_params:
      pk: integer
    response:
      200:
        content-type: application/json
        body: Comment
      404:
        description: Not found
  - name: Update own comment
    method: PATCH
    path: /api/comments/{pk}/
    auth: bearer
    path_params:
      pk: integer
    request:
      content-type: application/json
      body:
        content?: string
    response:
      200:
        content-type: application/json
        body: Comment
      400:
        description: Banned patterns violated
        content-type: application/json
        body: BannedViolation[]
      401:
        description: Unauthorized
      403:
        description: Forbidden
      404:
        description: Not found
  - name: Delete own comment (soft)
    method: DELETE
    path: /api/comments/{pk}/
    auth: bearer
    path_params:
      pk: integer
    response:
      204:
        description: Deleted
      401:
        description: Unauthorized
      403:
        description: Forbidden
      404:
        description: Not found
  - name: Toggle like on comment
    method: POST
    path: /api/comments/{pk}/like/
    auth: bearer
    path_params:
      pk: integer
    response:
      200:
        content-type: application/json
        body:
          liked: boolean
          likes_count: integer
      401:
        description: Unauthorized
      404:
        description: Not found

# Shared schemas
schemas:
  Comment:
    id: integer
    content: string # If deleted=true, returns placeholder "Комментарий удалён пользователем"
    user:
      id: integer
      username: string
    created_at: string(datetime)
    updated_at: string(datetime)
    edited: boolean
    deleted: boolean
    likes_count: integer
    is_owner: boolean
  BannedViolation:
    id: integer
    description: string
